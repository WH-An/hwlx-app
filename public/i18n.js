// 多语言配置文件
const i18n = {
  zh: {
    // 通用
    'site.title': '海外留学',
    'site.subtitle': '留学生活指南',
    'nav.home': '首页',
    'nav.study': '学习指导',
    'nav.life': '生活小贴士',
    'nav.enrollment': '入学步骤',
    'nav.hospital': '医院信息',
    'nav.share': '分享生活',
    'nav.fun': '娱乐休闲',
    'nav.login': '登录',
    'nav.register': '注册',
    'nav.profile': '个人中心',
    'nav.messages': '消息',
    'nav.logout': '退出登录',
    'nav.admin': '后台管理',
    'nav.language': '语言',
    'nav.language.zh': '中文',
    'nav.language.en': 'English',
    
    // 主页内容
    'main.welcome': '欢迎来到海外留学',
    'main.description': '为海外留学生提供全方位的生活指导和学习资源',
    'main.features.title': '主要功能',
    'main.features.study': '学习指导',
    'main.features.life': '生活小贴士',
    'main.features.enrollment': '入学步骤',
    'main.features.hospital': '医院信息',
    'main.features.share': '分享生活',
    'main.features.fun': '娱乐休闲',
    
    // 按钮和操作
    'btn.login': '登录',
    'btn.register': '注册',
    'btn.submit': '提交',
    'btn.cancel': '取消',
    'btn.save': '保存',
    'btn.edit': '编辑',
    'btn.delete': '删除',
    'btn.back': '返回',
    'btn.next': '下一步',
    'btn.previous': '上一步',
    'btn.confirm': '确认',
    'btn.close': '关闭',
    
    // 表单
    'form.email': '邮箱',
    'form.password': '密码',
    'form.nickname': '昵称',
    'form.confirm_password': '确认密码',
    'form.area': '地区',
    'form.degree': '学位',
    'form.verification_code': '验证码',
    'form.send_code': '发送验证码',
    'form.required': '必填项',
    'form.optional': '可选',
    
    // 消息
    'msg.login_success': '登录成功',
    'msg.register_success': '注册成功',
    'msg.logout_success': '退出成功',
    'msg.login_required': '请先登录',
    'msg.permission_denied': '权限不足',
    'msg.operation_success': '操作成功',
    'msg.operation_failed': '操作失败',
    'msg.network_error': '网络错误',
    'msg.loading': '加载中...',
    
    // 页面标题
    'page.title.main': '海外留学 · 主页面',
    'page.title.login': '海外留学 · 登录',
    'page.title.register': '海外留学 · 注册',
    'page.title.profile': '海外留学 · 个人中心',
    'page.title.study': '海外留学 · 学习指导',
    'page.title.life': '海外留学 · 生活小贴士',
    'page.title.enrollment': '海外留学 · 入学步骤',
    'page.title.hospital': '海外留学 · 医院信息',
    'page.title.share': '海外留学 · 分享生活',
    'page.title.fun': '海外留学 · 娱乐休闲',
    'page.title.messages': '海外留学 · 消息',
    'page.title.publish': '海外留学 · 发布内容',
    'page.title.admin': '海外留学 · 后台管理'
  },
  
  en: {
    // Common
    'site.title': 'Overseas Study',
    'site.subtitle': 'Study Abroad Guide',
    'nav.home': 'Home',
    'nav.study': 'Study Guide',
    'nav.life': 'Life Tips',
    'nav.enrollment': 'Enrollment Steps',
    'nav.hospital': 'Hospital Info',
    'nav.share': 'Share Life',
    'nav.fun': 'Entertainment',
    'nav.login': 'Login',
    'nav.register': 'Register',
    'nav.profile': 'Profile',
    'nav.messages': 'Messages',
    'nav.logout': 'Logout',
    'nav.admin': 'Admin Panel',
    'nav.language': 'Language',
    'nav.language.zh': '中文',
    'nav.language.en': 'English',
    
    // Main page content
    'main.welcome': 'Welcome to Overseas Study',
    'main.description': 'Comprehensive life guidance and learning resources for international students',
    'main.features.title': 'Main Features',
    'main.features.study': 'Study Guide',
    'main.features.life': 'Life Tips',
    'main.features.enrollment': 'Enrollment Steps',
    'main.features.hospital': 'Hospital Info',
    'main.features.share': 'Share Life',
    'main.features.fun': 'Entertainment',
    
    // Buttons and actions
    'btn.login': 'Login',
    'btn.register': 'Register',
    'btn.submit': 'Submit',
    'btn.cancel': 'Cancel',
    'btn.save': 'Save',
    'btn.edit': 'Edit',
    'btn.delete': 'Delete',
    'btn.back': 'Back',
    'btn.next': 'Next',
    'btn.previous': 'Previous',
    'btn.confirm': 'Confirm',
    'btn.close': 'Close',
    
    // Forms
    'form.email': 'Email',
    'form.password': 'Password',
    'form.nickname': 'Nickname',
    'form.confirm_password': 'Confirm Password',
    'form.area': 'Area',
    'form.degree': 'Degree',
    'form.verification_code': 'Verification Code',
    'form.send_code': 'Send Code',
    'form.required': 'Required',
    'form.optional': 'Optional',
    
    // Messages
    'msg.login_success': 'Login successful',
    'msg.register_success': 'Registration successful',
    'msg.logout_success': 'Logout successful',
    'msg.login_required': 'Please login first',
    'msg.permission_denied': 'Permission denied',
    'msg.operation_success': 'Operation successful',
    'msg.operation_failed': 'Operation failed',
    'msg.network_error': 'Network error',
    'msg.loading': 'Loading...',
    
    // Page titles
    'page.title.main': 'Overseas Study · Home',
    'page.title.login': 'Overseas Study · Login',
    'page.title.register': 'Overseas Study · Register',
    'page.title.profile': 'Overseas Study · Profile',
    'page.title.study': 'Overseas Study · Study Guide',
    'page.title.life': 'Overseas Study · Life Tips',
    'page.title.enrollment': 'Overseas Study · Enrollment Steps',
    'page.title.hospital': 'Overseas Study · Hospital Info',
    'page.title.share': 'Overseas Study · Share Life',
    'page.title.fun': 'Overseas Study · Entertainment',
    'page.title.messages': 'Overseas Study · Messages',
    'page.title.publish': 'Overseas Study · Publish',
    'page.title.admin': 'Overseas Study · Admin Panel'
  }
};

// 语言切换功能
class I18nManager {
  constructor() {
    this.currentLang = localStorage.getItem('language') || 'zh';
    this.init();
  }
  
  init() {
    this.updatePageLanguage();
    this.createLanguageSelector();
  }
  
  // 获取翻译文本
  t(key, lang = this.currentLang) {
    return i18n[lang]?.[key] || i18n['zh'][key] || key;
  }
  
  // 切换语言
  switchLanguage(lang) {
    this.currentLang = lang;
    localStorage.setItem('language', lang);
    this.updatePageLanguage();
    this.updateLanguageSelector();
  }
  
  // 更新页面语言
  updatePageLanguage() {
    // 更新HTML lang属性
    document.documentElement.lang = this.currentLang;
    
    // 更新页面标题
    const titleKey = this.getPageTitleKey();
    if (titleKey) {
      document.title = this.t(titleKey);
    }
    
    // 更新所有带有data-i18n属性的元素
    document.querySelectorAll('[data-i18n]').forEach(element => {
      const key = element.getAttribute('data-i18n');
      const text = this.t(key);
      
      if (element.tagName === 'INPUT' && element.type === 'text') {
        element.placeholder = text;
      } else if (element.tagName === 'INPUT' && element.type === 'submit') {
        element.value = text;
      } else {
        element.textContent = text;
      }
    });
    
    // 更新所有带有data-i18n-title属性的元素
    document.querySelectorAll('[data-i18n-title]').forEach(element => {
      const key = element.getAttribute('data-i18n-title');
      element.title = this.t(key);
    });
  }
  
  // 获取当前页面的标题键
  getPageTitleKey() {
    const path = window.location.pathname;
    const filename = path.split('/').pop() || 'main page.html';
    
    const pageMap = {
      'main page.html': 'page.title.main',
      'login.html': 'page.title.login',
      'register.html': 'page.title.register',
      'profile.html': 'page.title.profile',
      'study-guide.html': 'page.title.study',
      'life-tips.html': 'page.title.life',
      'enrollment-steps.html': 'page.title.enrollment',
      'hospital.html': 'page.title.hospital',
      'share.html': 'page.title.share',
      'fun.html': 'page.title.fun',
      'messages.html': 'page.title.messages',
      'publish.html': 'page.title.publish',
      'admin-all.html': 'page.title.admin'
    };
    
    return pageMap[filename];
  }
  
  // 创建语言选择器
  createLanguageSelector() {
    // 查找现有的语言选择器容器
    let selector = document.getElementById('language-selector');
    if (!selector) {
      selector = document.createElement('div');
      selector.id = 'language-selector';
      selector.className = 'language-selector';
      
      // 添加到导航栏或合适的位置
      const nav = document.querySelector('.nav-list') || document.querySelector('.sidebar');
      if (nav) {
        nav.appendChild(selector);
      } else {
        document.body.appendChild(selector);
      }
    }
    
    this.updateLanguageSelector();
  }
  
  // 更新语言选择器
  updateLanguageSelector() {
    const selector = document.getElementById('language-selector');
    if (!selector) return;
    
    selector.innerHTML = `
      <div class="language-dropdown">
        <button class="language-btn" onclick="toggleLanguageDropdown()">
          <span class="language-icon">🌐</span>
          <span class="language-text">${this.t('nav.language')}</span>
          <span class="dropdown-arrow">▼</span>
        </button>
        <div class="language-options" id="language-options">
          <div class="language-option ${this.currentLang === 'zh' ? 'active' : ''}" 
               onclick="i18nManager.switchLanguage('zh')">
            <span class="flag">🇨🇳</span>
            <span>${this.t('nav.language.zh')}</span>
          </div>
          <div class="language-option ${this.currentLang === 'en' ? 'active' : ''}" 
               onclick="i18nManager.switchLanguage('en')">
            <span class="flag">🇺🇸</span>
            <span>${this.t('nav.language.en')}</span>
          </div>
        </div>
      </div>
    `;
  }
}

// 全局函数
function toggleLanguageDropdown() {
  const options = document.getElementById('language-options');
  if (options) {
    options.style.display = options.style.display === 'block' ? 'none' : 'block';
  }
}

// 点击外部关闭下拉菜单
document.addEventListener('click', function(event) {
  const selector = document.getElementById('language-selector');
  const options = document.getElementById('language-options');
  
  if (selector && options && !selector.contains(event.target)) {
    options.style.display = 'none';
  }
});

// 初始化国际化管理器
let i18nManager;
document.addEventListener('DOMContentLoaded', function() {
  i18nManager = new I18nManager();
});

// 导出到全局
window.i18nManager = i18nManager;
window.toggleLanguageDropdown = toggleLanguageDropdown;
