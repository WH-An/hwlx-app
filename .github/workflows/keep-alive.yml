name: Keep Alive

on:
  schedule:
    # æ¯5åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
    - cron: '*/5 * * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping website
        run: |
          echo "ðŸ”„ å¼€å§‹ä¿æ´»æ£€æŸ¥..."
          echo "ðŸ“… æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ðŸŒ ç›®æ ‡: https://hai-wai-liu-xue.onrender.com"
          
          # è®¾ç½®è¶…æ—¶æ—¶é—´
          timeout=30
          
          # å‘é€GETè¯·æ±‚åˆ°ç½‘ç«™
          echo "ðŸ“¡ å‘é€è¯·æ±‚..."
          
          # ä½¿ç”¨æ›´å¥å£®çš„curlå‘½ä»¤
          response=$(curl -s -o /dev/null -w "%{http_code}" --max-time $timeout --retry 2 --retry-delay 1 https://hai-wai-liu-xue.onrender.com 2>/dev/null || echo "000")
          curl_exit_code=$?
          
          echo "ðŸ“Š å“åº”çŠ¶æ€ç : $response"
          echo "ðŸ”§ cURLé€€å‡ºç : $curl_exit_code"
          
          # æ£€æŸ¥ç»“æžœ
          if [ $curl_exit_code -eq 0 ] && [ "$response" = "200" ]; then
            echo "âœ… ç½‘ç«™å“åº”æ­£å¸¸ (HTTP $response)"
            echo "ðŸŽ‰ ä¿æ´»æˆåŠŸï¼"
            exit 0
          elif [ $curl_exit_code -eq 28 ]; then
            echo "â° è¯·æ±‚è¶…æ—¶ (è¶…è¿‡${timeout}ç§’)"
            echo "âš ï¸  ç½‘ç«™å¯èƒ½æ­£åœ¨å¯åŠ¨ä¸­..."
            exit 0  # è¶…æ—¶ä¸ç®—å¤±è´¥ï¼Œç»§ç»­ä¿æ´»
          elif [ $curl_exit_code -ne 0 ]; then
            echo "âŒ ç½‘ç»œè¿žæŽ¥å¤±è´¥ (cURLé”™è¯¯ç : $curl_exit_code)"
            echo "âš ï¸  è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç½‘ç«™çŠ¶æ€"
            exit 0  # ç½‘ç»œé—®é¢˜ä¸ç®—å¤±è´¥ï¼Œç»§ç»­ä¿æ´»
          else
            echo "âš ï¸  ç½‘ç«™å“åº”å¼‚å¸¸ (HTTP $response)"
            echo "ðŸ” å¯èƒ½çš„åŽŸå› ï¼š"
            echo "   - ç½‘ç«™æ­£åœ¨ç»´æŠ¤"
            echo "   - æœåŠ¡å™¨é”™è¯¯"
            echo "   - é‡å®šå‘æˆ–å…¶ä»–HTTPçŠ¶æ€"
            # å¯¹äºŽéž200çŠ¶æ€ç ï¼Œä¹Ÿç»§ç»­ä¿æ´»ï¼Œä¸æ ‡è®°ä¸ºå¤±è´¥
            exit 0
          fi
          
          echo "âœ… ä¿æ´»æ£€æŸ¥å®Œæˆ"
          echo "â° ä¸‹æ¬¡æ£€æŸ¥æ—¶é—´: $(date -v+5M '+%Y-%m-%d %H:%M:%S' 2>/dev/null || date -d '+5 minutes' '+%Y-%m-%d %H:%M:%S' 2>/dev/null || echo 'æ— æ³•è®¡ç®—ä¸‹æ¬¡æ—¶é—´')"
