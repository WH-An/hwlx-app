name: Keep Alive

on:
  schedule:
    # æ¯5åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
    - cron: '*/5 * * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping website
        run: |
          echo "ğŸ”„ å¼€å§‹ä¿æ´»æ£€æŸ¥..."
          echo "ğŸ“… æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸŒ ç›®æ ‡: https://hai-wai-liu-xue.onrender.com"
          
          # è®¾ç½®è¶…æ—¶æ—¶é—´
          timeout=30
          
          # å‘é€GETè¯·æ±‚åˆ°ç½‘ç«™
          echo "ğŸ“¡ å‘é€è¯·æ±‚..."
          response=$(curl -s -o /dev/null -w "%{http_code}" --max-time $timeout https://hai-wai-liu-xue.onrender.com)
          curl_exit_code=$?
          
          echo "ğŸ“Š å“åº”çŠ¶æ€ç : $response"
          echo "ğŸ”§ cURLé€€å‡ºç : $curl_exit_code"
          
          # æ£€æŸ¥ç»“æœ
          if [ $curl_exit_code -eq 0 ] && [ "$response" = "200" ]; then
            echo "âœ… ç½‘ç«™å“åº”æ­£å¸¸ (HTTP $response)"
            echo "ğŸ‰ ä¿æ´»æˆåŠŸï¼"
          elif [ $curl_exit_code -eq 28 ]; then
            echo "â° è¯·æ±‚è¶…æ—¶ (è¶…è¿‡${timeout}ç§’)"
            echo "âš ï¸  ç½‘ç«™å¯èƒ½æ­£åœ¨å¯åŠ¨ä¸­..."
          elif [ $curl_exit_code -ne 0 ]; then
            echo "âŒ ç½‘ç»œè¿æ¥å¤±è´¥ (cURLé”™è¯¯ç : $curl_exit_code)"
            echo "âš ï¸  è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç½‘ç«™çŠ¶æ€"
          else
            echo "âš ï¸  ç½‘ç«™å“åº”å¼‚å¸¸ (HTTP $response)"
            echo "ğŸ” å¯èƒ½çš„åŸå› ï¼š"
            echo "   - ç½‘ç«™æ­£åœ¨ç»´æŠ¤"
            echo "   - æœåŠ¡å™¨é”™è¯¯"
            echo "   - é‡å®šå‘æˆ–å…¶ä»–HTTPçŠ¶æ€"
          fi
          
          echo "âœ… ä¿æ´»æ£€æŸ¥å®Œæˆ"
          echo "â° ä¸‹æ¬¡æ£€æŸ¥æ—¶é—´: $(date -d '+5 minutes' '+%Y-%m-%d %H:%M:%S')"
