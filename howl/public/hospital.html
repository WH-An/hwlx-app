<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>海外留学 · 地区选择</title>
  <style>
    :root{--bg:#0b0f14; --panel:#ffffff; --text:#0f172a; --muted:#64748b; --accent:#16a34a; --border:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,.18); --radius:18px;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:'Microsoft YaHei',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'PingFang SC',sans-serif;
      background:radial-gradient(1200px 600px at 10% -10%,#1f8db8 18%, transparent 60%),
                 radial-gradient(900px 500px at 110% 110%,#2bb8d6 12%, transparent 60%),var(--bg);
      color:#fff;overflow:visible;}
    .container{display:grid;grid-template-columns:220px 1fr;gap:18px;height:100vh;padding:24px}
    .sidebar{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px 16px;color:var(--text);display:flex;flex-direction:column;gap:16px}
    .account-info{display:flex;flex-direction:column;align-items:center;gap:10px;text-decoration:none;color:inherit;border:1px dashed #eef2ff;border-radius:14px;padding:14px;background:#fff}
    .avatar{width:56px;height:56px;border-radius:50%;object-fit:cover}
    .username{font-weight:700}
    .nav-list{list-style:none;margin:6px 0 0;padding:0;display:flex;flex-direction:column;gap:10px}
    .nav-list a{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);border:1px solid var(--border);background:#fafafa;border-radius:12px;padding:10px 14px;transition:.2s}
    .nav-list a:hover{background:#f3f4f6;transform:translateY(-1px)}
    .nav-icon{width:22px;display:inline-flex;justify-content:center}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;color:var(--text);display:flex;flex-direction:column;gap:14px;height:100%;overflow-y:auto}
    .search-box{display:flex;gap:10px;flex-shrink:0}
    .search-box input{flex:1;padding:10px 14px;border:1px solid var(--border);border-radius:12px;font-size:15px;outline:none}
    .search-box button{padding:10px 16px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .search-box button:hover{background:#15803d}
    .panel-header{display:flex;align-items:center;gap:12px;flex-shrink:0}
    .panel-title{font-size:18px;font-weight:800;margin:0}
    .panel-header .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;gap:8px;cursor:pointer;border:1px solid var(--border);background:#fff;color:#111827;border-radius:12px;padding:8px 12px;font-weight:700;transition:.2s}
    .btn:hover{background:#f3f4f6}
    
    /* EMGS诊所表格样式 */
    .emgs-table-container {
      display: none;
      margin-top: 20px;
    }
    
    .emgs-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .emgs-table th,
    .emgs-table td {
      padding: 12px 8px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      font-size: 14px;
    }
    
    .emgs-table th {
      background: #f8fafc;
      font-weight: 700;
      color: #374151;
    }
    
    .emgs-table tr:hover {
      background: #f9fafb;
    }
    
    .emgs-table a {
      color: #2563eb;
      text-decoration: none;
    }
    
    .emgs-table a:hover {
      text-decoration: underline;
    }
    
    .emgs-title {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <a class="account-info" href="profile.html">
        <img src="" alt="头像" class="avatar"><span class="username">我的账号</span>
      </a>
      <ul class="nav-list">
        <li><a href="main page.html"><span class="nav-icon">🏠</span><span>主页</span></a></li>
        <li><a href="life-tips.html"><span class="nav-icon">💡</span><span>生活小贴士</span></a></li>
        <li><a href="study-guide.html"><span class="nav-icon">📚</span><span>学习指导</span></a></li>
        <li><a href="enrollment-steps.html"><span class="nav-icon">📝</span><span>入学步骤</span></a></li>
        <li><a href="share.html"><span class="nav-icon">🔗</span><span>分享</span></a></li>
        <li><a href="fun.html"><span class="nav-icon">🎉</span><span>娱乐</span></a></li>
        <li><a href="hospital.html"><span class="nav-icon">🏥</span><span>医院</span></a></li>
      </ul>
    </div>

    <div class="panel">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="搜索地区...">
        <button onclick="alert('请输入关键词后再搜索')">搜索</button>
      </div>
      <div class="panel-header">
        <h2 class="panel-title">地区</h2>
        <div class="spacer"></div>
        <select id="regionSelect" class="btn">
          <option value="">请选择你所在的地区</option>
          <option value="kuala-lumpur">Kuala Lumpur</option>
          <option value="selangor">Selangor</option>
          <option value="johor">Johor</option>
          <option value="perak">Perak</option>
          <option value="melaka">Melaka</option>
          <option value="pahang">Pahang</option>
          <option value="perlis">Perlis</option>
          <option value="penang">Penang</option>
          <option value="negeri-sembilan">Negeri Sembilan</option>
        </select>
      </div>
      
      <!-- EMGS诊所表格容器 -->
      <div id="emgsTableContainer" class="emgs-table-container">
        <h3 class="emgs-title">EMGS诊所列表 - Kuala Lumpur</h3>
        <table class="emgs-table">
          <thead>
            <tr>
              <th>编号</th>
              <th>诊所名称</th>
              <th>地址</th>
              <th>营业时间</th>
              <th>EMGS筛查时间</th>
              <th>负责医生</th>
              <th>联系方式</th>
              <th>地图</th>
            </tr>
          </thead>
          <tbody id="emgsTableBody">
            <!-- 表格内容将通过JavaScript动态生成 -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // EMGS诊所数据 - 按地区分类
    const emgsClinicsData = {
      'kuala-lumpur': [
      ],
      'selangor': [
        {
          no: 1,
          name: "Klinik Anis, Banting",
          address: "No 6-G Jalan Bunga Pekan 2, 42700 Banting, Selangor",
          operatingHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm",
          doctor: "Dr. Mohammed Zahar",
          contact: "Tel: 03-3181 2396<br>Email: anis_banting@yahoo.com",
          map: "https://www.google.com/maps/search/Klinik+Anis+Banting"
        },
        {
          no: 2,
          name: "Klinik Harmoni – Cyberjaya",
          address: "No. 4, Jalan Cyber Valey 1a/1, Cyber Valley Commercial Centre, 43800 Dengkil, Selangor",
          operatingHours: "Mon–Sun: 8:30 am – 6:00 pm",
          emgsHours: "Mon–Fri: 8:30 am – 1:00 pm<br>3:00 pm – 6:00 pm",
          doctor: "Dr. Mohd Fakhruddin bin A Sani",
          contact: "Tel: 03-8768 8012<br>Email: fatinfaqiha@yahoo.co.uk",
          map: "https://www.google.com/maps/search/Klinik+Harmoni+Cyberjaya"
        },
        {
          no: 3,
          name: "SV Care Clinic (Qualitas) – Cyberjaya",
          address: "No. 2-G, Nadayu Square, Persiaran Bestari, Cyberjaya, 63000, Selangor",
          operatingHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat/Sun & PH: 9:00 am – 1:00 pm",
          emgsHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat/Sun & PH: 9:00 am – 1:00 pm",
          doctor: "Dr. Vikneswaran Sabramani",
          contact: "Tel: 03-8325 1996<br>Email: svcareclinic@yahoo.com",
          map: "https://www.google.com/maps/search/SV+Care+Clinic+Cyberjaya"
        },
        {
          no: 4,
          name: "Klinik Alam Medic Meru",
          address: "No. 251, Jalan Meru, Taman Bunga Melor, 41050 Klang, Selangor",
          operatingHours: "Mon–Fri: 9:00 am – 4:00 pm<br>Sat–Sun & PH: Closed",
          emgsHours: "Mon–Fri: 9:00 am – 4:00 pm",
          doctor: "Dr. Sangeeta Kaur Singh",
          contact: "Tel: 03-3342 6536<br>Email: klinik.alam.medic@gmail.com",
          map: "https://www.google.com/maps/search/Klinik+Alam+Medic+Meru+Klang"
        },
        {
          no: 5,
          name: "Klinik Prime Care, Wisma MCIS (CC107)",
          address: "Lot 7, Wisma MCIS Annexe, Jalan Barat, 46200 Petaling Jaya, Selangor",
          operatingHours: "Mon–Fri: 8:00 am – 9:00 pm<br>Sat: 8:00 am – 1:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 8:00 am – 4:00 pm<br>Sat: 8:00 am – 12:00 pm",
          doctor: "Dr. Thiakarajan Pachiappan",
          contact: "Tel: 03-7955 0550<br>Email: pcpj@qualitas.com.my",
          map: "https://www.google.com/maps/search/Wisma+MCIS+Annexe+Petaling+Jaya"
        },
        {
          no: 6,
          name: "Poliklinik Cahaya (Pandamaran) Sdn Bhd",
          address: "No.90, Solok Pandamar Indah 1, Taman Pendamar Indah, 42000 Port Klang, Selangor",
          operatingHours: "Mon–Fri: 8:00 am – 5:00 pm",
          emgsHours: "Mon–Fri: 8:00 am – 4:00 pm",
          doctor: "Dr. N. Pasupathi A/L Nadarajan",
          contact: "Tel: 03-3168 6510<br>Email: drpasu@cahayaclinics.com",
          map: "https://www.google.com/maps/search/Poliklinik+Cahaya+Pandamaran+Port+Klang"
        },
        {
          no: 7,
          name: "Klinik Nanda",
          address: "33, Ground Floor Jalan Dato Hamzah, 41000 Klang, Selangor",
          operatingHours: "Mon–Sun: 8:00 am – 10:00 pm",
          emgsHours: "Mon–Sun: 8:00 am – 10:00 pm",
          doctor: "Dr. Jackvin Derdeep",
          contact: "Tel: 03-3372 8881<br>Email: knanda@qualitas.com",
          map: "https://www.google.com/maps/search/Klinik+Nanda+Klang"
        },
        {
          no: 8,
          name: "Klinik Utama Rantau Panjang 24 Jam",
          address: "Lot 31-A1, A2, A3 (GF) Jalan Sungai Nibong 14A/KU4, Kampung Rantau Panjang, 42100 Klang, Selangor",
          operatingHours: "Mon–Fri: 8:00 am – 4:00 pm",
          emgsHours: "Mon–Fri: 8:00 am – 4:00 pm",
          doctor: "Dr. Nik Irfan Haziq",
          contact: "Tel: 03-3081 2283<br>Email: klinikutamarantaupanjang@gmail.com",
          map: "https://www.google.com/maps/search/Klinik+Utama+Rantau+Panjang+Klang"
        },
        {
          no: 9,
          name: "Selcare Clinic, Puchong (CC220)",
          address: "Block A-14-0-6, Jalan Permai 1/1, Taman Puchong Permai, Batu 13, 47100 Puchong, Selangor",
          operatingHours: "Mon–Fri: 8:00 am – 5:00 pm<br>Sat–Sun: 8:00 am – 12:00 pm",
          emgsHours: "Same as operating hours",
          doctor: "Dr. Chitra Balasingam",
          contact: "Tel: 03-5882 0650<br>Fax: 03-5885 1177; Email: psp_2967@yahoo.com",
          map: "https://www.google.com/maps/search/Selcare+Clinic+Puchong"
        },
        {
          no: 10,
          name: "Klinik Rakan Medik – Puchong (CC169)",
          address: "25G, Jalan Bandar 10, Pusat Bandar Puchong, 47100 Puchong, Selangor",
          operatingHours: "Mon–Fri: 9:00 am – 6:00 pm<br>Sat: 9:00 am – 1:00 pm",
          emgsHours: "Same as operating hours",
          doctor: "Dr. Rajamohan A/L Annamalai",
          contact: "Tel: 03-5882 4627<br>Fax: 03-5882 5384; Email: klinik_rakanmedik@yahoo.com",
          map: "https://www.google.com/maps/search/Klinik+Rakan+Medik+Puchong"
        },
        {
          no: 11,
          name: "Selcare Clinic, Putrajaya (CC180)",
          address: "No.13, Jalan P9, B/1 Presint 9, 62250 Putrajaya",
          operatingHours: "Mon–Sun: 7:00 am – 10:00 pm",
          emgsHours: "Mon–Fri 8:00 am – 5:00 pm<br>Sat 8:00 am – 12:00 pm; Sun & PH Closed",
          doctor: "Dr. R. Mohanasundram",
          contact: "Tel: 03-8888 0268<br>Email: selcareclinic.putrajaya@gmail.com / psp_putrajaya@yahoo.com",
          map: "https://www.google.com/maps/place/Selcare+Clinic+Putrajaya"
        },
        {
          no: 12,
          name: "Klinik Rakan Medik, Rawang",
          address: "No 15, Jalan Bandar Rawang 2, Bandar Baru Rawang, 48000 Rawang, Selangor",
          operatingHours: "Mon–Fri: 8:30 am – 5:00 pm<br>Sat: 8:30 am – 12:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 8:30 am – 5:00 pm<br>Sat: 8:30 am – 12:00 pm",
          doctor: "Dr. Shahrul Nizam",
          contact: "Tel: 03-6092 5181<br>Email: rmrw@qualitas.com.my",
          map: "https://www.google.com/maps/search/Klinik+Rakan+Medik+Rawang"
        },
        {
          no: 13,
          name: "Klinik Kota Warisan (CC177)",
          address: "16 Jalan Warisan Megah 1/5, Kota Warisan, 43900 Sepang, Selangor",
          operatingHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm",
          doctor: "Dr. Haji Mohd Adnan",
          contact: "Tel: 03-8706 1395<br>Email: klinikkotawarisan@yahoo.com",
          map: "https://www.google.com/maps/search/Klinik+Kota+Warisan+Sepang"
        },
        {
          no: 14,
          name: "Klinik Medic Bestari (CC217)",
          address: "No.31 Jalan USJ 1/19, Taman Subang Permai, 47500 Subang Jaya, Selangor",
          operatingHours: "Sun–Mon 8:00 am – 11:00 pm",
          emgsHours: "Mon–Fri 8:00 am – 5:00 pm",
          doctor: "Dr. Kavitha A/P Yogeswaran",
          contact: "Tel: 03-5638 4137<br>Email: sharifah@qualitas.com.my",
          map: "https://www.google.com/maps/search/Klinik+Medic+Bestari+Subang+Jaya"
        },
        {
          no: 15,
          name: "Klinik Dr Nur Ainita (CC110)",
          address: "No. 12 A-1, Ground Floor, Jalan USJ 9/5Q, Subang Business Centre, 47620 Subang Jaya, Selangor",
          operatingHours: "Mon–Thu 8:30 am – 10:00 pm<br>Fri 8:30 am – 12:30 pm & 2:00 pm – 10:00 pm; Sat 8:30 am – 2:00 pm; Sun & PH Closed",
          emgsHours: "Mon–Fri 8:30 am – 4:30 pm",
          doctor: "Dr. Periakka Kuganes",
          contact: "Tel: 03-8024 4844<br>Email: kdna@qualitas.com.my",
          map: "https://www.google.com/maps/search/Klinik+Dr+Nur+Ainita+Subang+Jaya"
        },
        {
          no: 16,
          name: "Kumpulan Medic – Subang Jaya (CC167)",
          address: "No. 22 Jalan SS15/4D, 47500 Subang Jaya, Selangor",
          operatingHours: "Mon–Sat 8:30 am – 4:30 pm<br>Sun & PH 9:00 am – 12:00 pm",
          emgsHours: "Same as operating hours",
          doctor: "Dr. Suresh A/L Ganesan",
          contact: "Tel: 03-5633 0913<br>Email: kmsj@qualitas.com.my",
          map: "https://www.google.com/maps/search/Kumpulan+Medic+Subang+Jaya"
        },
        {
          no: 17,
          name: "Klinik Saujana",
          address: "No 6-A Lorong Elmin E 1, Sg Buloh Country, 47000 Sungai Buloh, Selangor",
          operatingHours: "Mon–Fri: 9:00 am – 5:00 pm",
          emgsHours: "Mon–Fri: 9:00 am – 11:00 am<br>3:00 pm – 7:00 pm",
          doctor: "Dr. Ravinder S. Dhillon",
          contact: "Tel: 03-6038 5113<br>Email: kdk_siddhu@yahoo.com",
          map: "https://www.google.com/maps/search/Klinik+Saujana+Sungai+Buloh"
        }
      ],
      'johor': [
        {
          no: 1,
          name: "Klinik Permai Johor Bahru (CC125)",
          address: "No 18, Jalan Serampang, Taman Sri Tebrau, 80050 Johor Bahru, Johor",
          operatingHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm",
          doctor: "Dr. Lee Mun Choong",
          contact: "Tel: 07-333 4000<br>Email: klinikpermaijb@gmail.com",
          map: "https://www.google.com/maps/search/Klinik+Permai+Johor+Bahru"
        }
      ],
      'perak': [
        {
          no: 1,
          name: "Klinik Rakan Medik Ipoh (CC184)",
          address: "41-43, Persiaran Greenhill, 30450 Ipoh, Perak",
          operatingHours: "Mon–Fri: 8:30 am – 5:00 pm<br>Sat: 8:30 am – 12:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 8:30 am – 5:00 pm<br>Sat: 8:30 am – 12:00 pm",
          doctor: "Dr. Mazlina Bt. Mohd Radzi",
          contact: "Tel: 05-253 7595<br>Email: krmipoh@qualitas.com.my",
          map: "https://www.google.com/maps/search/Klinik+Rakan+Medik+Ipoh+Perak"
        }
      ],
      'melaka': [
        {
          no: 1,
          name: "Klinik Mediviron Melaka (CC210)",
          address: "No. 1, Jalan TU 42, Taman Tasik Utama, 75450 Ayer Keroh, Melaka",
          operatingHours: "Mon–Fri: 8:00 am – 9:00 pm<br>Sat: 8:00 am – 1:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 8:00 am – 4:30 pm<br>Sat: 8:00 am – 12:00 pm",
          doctor: "Dr. T. Baskaran",
          contact: "Tel: 06-232 9911<br>Email: medivironmelaka@gmail.com",
          map: "https://www.google.com/maps/search/Klinik+Mediviron+Melaka"
        }
      ],
      'pahang': [
        {
          no: 1,
          name: "Klinik Qualitas Health Kuantan (CC200)",
          address: "B62 & B63, Lorong Tun Ismail 6, Sri Dagangan Business Centre, 25000 Kuantan, Pahang",
          operatingHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 9:00 am – 5:00 pm<br>Sat: 9:00 am – 1:00 pm",
          doctor: "Dr. Chia Yee Ling",
          contact: "Tel: 09-513 6635<br>Email: klinikqualitaskuantan@gmail.com",
          map: "https://www.google.com/maps/search/Klinik+Qualitas+Health+Kuantan+Pahang"
        }
      ],
      'perlis': [
        {
          no: 1,
          name: "Klinik Rakan Medik Perlis (CC232)",
          address: "No 23, Jalan Medan Niaga, Medan Niaga Kangar, 01000 Kangar, Perlis",
          operatingHours: "Mon–Fri: 8:30 am – 5:00 pm<br>Sat: 8:30 am – 12:00 pm; Sun & PH: Closed",
          emgsHours: "Mon–Fri: 8:30 am – 5:00 pm<br>Sat: 8:30 am – 12:00 pm",
          doctor: "Dr. Zarina Mohamed",
          contact: "Tel: 04-976 3566<br>Email: krmperlis@qualitas.com.my",
          map: "https://www.google.com/maps/search/Klinik+Rakan+Medik+Perlis"
        }
      ],
      'penang': [
      ],
      'negeri-sembilan': [
      ]
    };

    // 显示EMGS诊所表格
    function showEmgsTable(region) {
      const container = document.getElementById('emgsTableContainer');
      const tbody = document.getElementById('emgsTableBody');
      const title = document.querySelector('.emgs-title');
      
      // 清空表格内容
      tbody.innerHTML = '';
      
      // 获取对应地区的诊所数据
      const clinics = emgsClinicsData[region] || [];
      
      if (clinics.length === 0) {
        // 如果没有数据，显示提示信息
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="8" style="text-align: center; padding: 20px; color: #666;">暂无该地区的EMGS诊所信息</td>';
        tbody.appendChild(row);
      } else {
        // 生成表格行
        clinics.forEach(clinic => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${clinic.no}</td>
            <td>${clinic.name}</td>
            <td>${clinic.address}</td>
            <td>${clinic.operatingHours}</td>
            <td>${clinic.emgsHours}</td>
            <td>${clinic.doctor}</td>
            <td>${clinic.contact}</td>
            <td><a href="${clinic.map}" target="_blank">查看地图</a></td>
          `;
          tbody.appendChild(row);
        });
      }
      
      // 更新标题
      const regionNames = {
        'kuala-lumpur': 'Kuala Lumpur',
        'selangor': 'Selangor',
        'penang': 'Penang',
        'johor': 'Johor',
        'perak': 'Perak',
        'negeri-sembilan': 'Negeri Sembilan'
      };
      title.textContent = `EMGS诊所列表 - ${regionNames[region] || region}`;
      
      // 显示表格
      container.style.display = 'block';
    }

    // 隐藏EMGS诊所表格
    function hideEmgsTable() {
      const container = document.getElementById('emgsTableContainer');
      container.style.display = 'none';
    }

    // 地区选择逻辑
    document.getElementById('regionSelect').addEventListener('change', function() {
      const selectedValue = this.value;
      const selectedText = this.options[this.selectedIndex].text;
      
      console.log('选择的地区:', selectedValue);
      console.log('地区数据:', emgsClinicsData[selectedValue]);
      
      if (selectedValue && emgsClinicsData[selectedValue] && emgsClinicsData[selectedValue].length > 0) {
        showEmgsTable(selectedValue);
      } else {
        hideEmgsTable();
        if (selectedValue && selectedValue !== '') {
          alert("您选择了: " + selectedText + "\n该地区暂无EMGS诊所信息");
        }
      }
    });
    // 和你之前页面一致的最小依赖
  // 自动检测API基础URL
  const API_BASE = (() => {
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
      return 'http://127.0.0.1:3001';
    }
    return ''; // 生产环境使用相对路径
  })();

  // 把相对路径头像补成绝对路径
  function toAbs(u){
    if(!u) return '';
    if(/^https?:\/\//i.test(u)) return u;
    return u.startsWith('/') ? API_BASE + u : API_BASE + '/' + u;
  }

  // 恢复：优先从服务器获取最新用户信息，回退到 localStorage
  async function hydrateUser(){
    try{
      const avatarEl = document.querySelector('.avatar');
      const nameEl   = document.querySelector('.username');

      // 占位头像
      const FALLBACK = 'https://raw.githubusercontent.com/WH-An/hwlx-app/2df4e97b395bebb7977074fbb31741f3c35da9a0/assets-task_01k3v2vy06fra8er06x602xnpe-1756476933_img_1.webp';

      // 优先从服务器获取最新用户信息
      try {
        const response = await fetch(API_BASE + '/api/users/me', { 
          credentials: 'include' 
        });
        
        if (response.ok) {
          const user = await response.json();
          const name = user.nickname || user.username || user.displayName || user.name || user.email || '我的账号';
          let avatar = user.avatarPath || user.avatarUrl || user.avatar || '';

          if(avatar && !/^https?:\/\//i.test(avatar)) {
            avatar = toAbs(avatar);
          }

          nameEl.textContent = name;
          nameEl.title = name;
          avatarEl.onerror = ()=>{ avatarEl.src = FALLBACK; };
          avatarEl.src = avatar || FALLBACK;
          avatarEl.alt = name;
          
          // 更新本地存储
          localStorage.setItem('currentUser', JSON.stringify(user));
          return;
        }
      } catch (e) {
        console.warn('从服务器获取用户信息失败，使用本地存储:', e);
      }

      // 如果服务器获取失败，回退到本地存储
      const raw = localStorage.getItem('currentUser')
                || localStorage.getItem('user')
                || localStorage.getItem('USER')
                || localStorage.getItem('auth_user');

      if(!raw){
        nameEl.textContent = '我的账号';
        avatarEl.src = FALLBACK;
        return;
      }

      const u = JSON.parse(raw) || {};
      const name = u.nickname || u.username || u.displayName || u.name || u.email || '我的账号';
      let avatar = u.avatarPath || u.avatarUrl || u.avatar || '';

      if(avatar && !/^https?:\/\//i.test(avatar)) {
        avatar = toAbs(avatar);
      }

      nameEl.textContent = name;
      nameEl.title = name;
      avatarEl.onerror = ()=>{ avatarEl.src = FALLBACK; };
      avatarEl.src = avatar || FALLBACK;
      avatarEl.alt = name;
    }catch(e){
      console.error('用户信息渲染失败:', e);
      // 出错也给个兜底
      const avatarEl = document.querySelector('.avatar');
      const nameEl   = document.querySelector('.username');
      nameEl.textContent = '我的账号';
      avatarEl.src = FALLBACK;
    }
  }

  // 页面就绪后执行
  window.addEventListener('DOMContentLoaded', () => {
    hydrateUser();
  });
  </script>
</body>
</html>
