<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>海外留学 · 地区选择</title>
  <style>
    :root{--bg:#0b0f14; --panel:#ffffff; --text:#0f172a; --muted:#64748b; --accent:#16a34a; --border:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,.18); --radius:18px;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:'Microsoft YaHei',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'PingFang SC',sans-serif;
      background:radial-gradient(1200px 600px at 10% -10%,#1f8db8 18%, transparent 60%),
                 radial-gradient(900px 500px at 110% 110%,#2bb8d6 12%, transparent 60%),var(--bg);
      color:#fff;overflow:hidden;}
    .container{display:grid;grid-template-columns:220px 1fr;gap:18px;height:100vh;padding:24px}
    .sidebar{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px 16px;color:var(--text);display:flex;flex-direction:column;gap:16px}
    .account-info{display:flex;flex-direction:column;align-items:center;gap:10px;text-decoration:none;color:inherit;border:1px dashed #eef2ff;border-radius:14px;padding:14px;background:#fff}
    .avatar{width:56px;height:56px;border-radius:50%;object-fit:cover}
    .username{font-weight:700}
    .nav-list{list-style:none;margin:6px 0 0;padding:0;display:flex;flex-direction:column;gap:10px}
    .nav-list a{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);border:1px solid var(--border);background:#fafafa;border-radius:12px;padding:10px 14px;transition:.2s}
    .nav-list a:hover{background:#f3f4f6;transform:translateY(-1px)}
    .nav-icon{width:22px;display:inline-flex;justify-content:center}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;color:var(--text);display:flex;flex-direction:column;gap:14px;height:100%}
    .search-box{display:flex;gap:10px;flex-shrink:0}
    .search-box input{flex:1;padding:10px 14px;border:1px solid var(--border);border-radius:12px;font-size:15px;outline:none}
    .search-box button{padding:10px 16px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .search-box button:hover{background:#15803d}
    .panel-header{display:flex;align-items:center;gap:12px;flex-shrink:0}
    .panel-title{font-size:18px;font-weight:800;margin:0}
    .panel-header .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;gap:8px;cursor:pointer;border:1px solid var(--border);background:#fff;color:#111827;border-radius:12px;padding:8px 12px;font-weight:700;transition:.2s}
    .btn:hover{background:#f3f4f6}
    
    /* EMGS诊所表格样式 */
    .emgs-table-container {
      display: none;
      margin-top: 20px;
      overflow-x: auto;
    }
    
    .emgs-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .emgs-table th,
    .emgs-table td {
      padding: 12px 8px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      font-size: 14px;
    }
    
    .emgs-table th {
      background: #f8fafc;
      font-weight: 700;
      color: #374151;
    }
    
    .emgs-table tr:hover {
      background: #f9fafb;
    }
    
    .emgs-table a {
      color: #2563eb;
      text-decoration: none;
    }
    
    .emgs-table a:hover {
      text-decoration: underline;
    }
    
    .emgs-title {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <a class="account-info" href="profile.html">
        <img src="" alt="头像" class="avatar"><span class="username">我的账号</span>
      </a>
      <ul class="nav-list">
        <li><a href="main page.html"><span class="nav-icon">🏠</span><span>主页</span></a></li>
        <li><a href="life-tips.html"><span class="nav-icon">💡</span><span>生活小贴士</span></a></li>
        <li><a href="study-guide.html"><span class="nav-icon">📚</span><span>学习指导</span></a></li>
        <li><a href="enrollment-steps.html"><span class="nav-icon">📝</span><span>入学步骤</span></a></li>
        <li><a href="share.html"><span class="nav-icon">🔗</span><span>分享</span></a></li>
        <li><a href="fun.html"><span class="nav-icon">🎉</span><span>娱乐</span></a></li>
        <li><a href="hospital.html"><span class="nav-icon">🏥</span><span>医院</span></a></li>
      </ul>
    </div>

    <div class="panel">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="搜索地区...">
        <button onclick="alert('请输入关键词后再搜索')">搜索</button>
      </div>
      <div class="panel-header">
        <h2 class="panel-title">地区</h2>
        <div class="spacer"></div>
        <select id="regionSelect" class="btn">
          <option value="">请选择你所在的地区</option>
          <option value="kuala-lumpur">Kuala Lumpur</option>
          <option value="putrajaya">Putrajaya</option>
          <option value="cyberjaya">Cyberjaya</option>
          <option value="petaling-jaya">Petaling Jaya</option>
          <option value="puchong">Puchong</option>
          <option value="subang-jaya">Subang Jaya</option>
          <option value="kajang">Kajang</option>
          <option value="seri-kembangan">Seri Kembangan</option>
          <option value="bangi">Bangi</option>
          <option value="cheras">Cheras</option>
          <option value="sungai-buloh">Sungai Buloh</option>
          <option value="shah-alam">Shah Alam</option>
          <option value="klang">Klang</option>
          <option value="port-klang">Port Klang</option>
          <option value="banting">Banting</option>
          <option value="rawang">Rawang</option>
          <option value="sepang">Sepang</option>
          <option value="melaka">Melaka</option>
          <option value="johor">Johor</option>
          <option value="perak">Perak</option>
          <option value="pahang">Pahang</option>
          <option value="perlis">Perlis</option>
          <option value="terengganu">Terengganu</option>
          <option value="kelantan">Kelantan</option>
          <option value="kedah">Kedah</option>
          <option value="pulau-pinang">Pulau Pinang</option>
          <option value="sarawak">Sarawak</option>
          <option value="university-campuses">University Campuses</option>
        </select>
      </div>
      
      <!-- EMGS诊所表格容器 -->
      <div id="emgsTableContainer" class="emgs-table-container">
        <h3 class="emgs-title">EMGS诊所列表 - Kuala Lumpur</h3>
        <table class="emgs-table">
          <thead>
            <tr>
              <th>编号</th>
              <th>诊所名称</th>
              <th>地址</th>
              <th>营业时间</th>
              <th>EMGS筛查时间</th>
              <th>负责医生</th>
              <th>联系方式</th>
              <th>地图</th>
            </tr>
          </thead>
          <tbody id="emgsTableBody">
            <!-- 表格内容将通过JavaScript动态生成 -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // EMGS诊所数据
    const emgsClinics = [
      {
        no: 1,
        name: "Kumpulan Medic, Menara Boustead (CC101)",
        address: "Tingkat 5, Wisma Boustead, 71 Jalan Raja Chulan, 50200 KL",
        operatingHours: "Mon–Fri 8.30am–5.00pm<br>Sat 8.30am–1.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 8.30am–4.30pm<br>Sat 8.30am–12.00pm",
        doctor: "Dr. Praveena Chandra Sekaran",
        contact: "03-2022 4141<br>kmbo@qualitas.com.my",
        map: "https://maps.app.goo.gl/s1qbnri49RMHy7MH7"
      },
      {
        no: 2,
        name: "Klinik Catterall, Khoo & Raja Malek, Plaza Sentral (CC103)",
        address: "Suite 3B-3-6, Level 3 Block 3B, Plaza Sentral, KL Sentral, 50470 KL",
        operatingHours: "Mon–Fri 8.00am–4.30pm<br>Sat 8.00am–12.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 8.30am–4.30pm<br>Sat 8.00am–12.00pm",
        doctor: "Dr. Amirtha Davi",
        contact: "03-2273 0244<br>ckps@qualitas.com.my",
        map: "https://maps.app.goo.gl/VUPPoQ2FYdnZHoWv8"
      },
      {
        no: 3,
        name: "Klinik Ng & Lee, Jalan Pudu (CC102)",
        address: "462 & 464 Jalan Pudu, 55100 KL",
        operatingHours: "24 Hours",
        emgsHours: "Daily 8.00am–7.00pm",
        doctor: "-",
        contact: "03-9222 5989 / 6591<br>nlpu@qualitas.com.my",
        map: "https://maps.app.goo.gl/3xQdo21HDg1smMA28"
      },
      {
        no: 4,
        name: "Poliklinik Central & Surgeri, Gombak (CC104)",
        address: "No 20, Jalan Suria Setapak, Batu 4½ Jalan Gombak, 53000 KL",
        operatingHours: "Daily 8.00am–10.00pm",
        emgsHours: "Daily 8.00am–7.00pm",
        doctor: "Dr. R. S. Kumar",
        contact: "03-4023 4390<br>pcsg@qualitas.com.my",
        map: "https://maps.app.goo.gl/FFUXLxSvJKEyWSNx5"
      },
      {
        no: 5,
        name: "Klinik Ng & Lee, Jalan Ampang (CC105)",
        address: "377 Jalan Ampang, 50450 KL",
        operatingHours: "Mon–Fri 8.00am–4.00pm<br>Sat 8.00am–12.00pm<br>Sun & PH Closed",
        emgsHours: "Daily 9.00am–4.00pm<br>Sat 8.00am–12.00pm",
        doctor: "-",
        contact: "03-4266 0764<br>nlap@qualitas.com.my",
        map: "https://maps.app.goo.gl/wQZkkiyCyRF6i2Fx8"
      },
      {
        no: 6,
        name: "Qualitas Health Klinik Kumpulan Medic, Jalan Ampang (CC140)",
        address: "1st Floor, 39 Jalan Ampang, 50100 KL",
        operatingHours: "Mon–Fri 8.30am–5.00pm<br>Sat 8.30am–1.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 8.30am–3.00pm<br>Sat 8.30am–1.00pm",
        doctor: "Dr. Abigail Ann Maathai",
        contact: "03-2078 1532<br>kmja@qualitas.com.my",
        map: "https://maps.app.goo.gl/XtWmMcd5fVY7ypfy9"
      },
      {
        no: 7,
        name: "Klinik Sentosa (CC145)",
        address: "No. 25, 68000 Ampang, Selangor",
        operatingHours: "24 Hours",
        emgsHours: "Daily 7.00am–7.00pm",
        doctor: "-",
        contact: "03-4291 1458<br>rama_fiftyseven@yahoo.com",
        map: "https://maps.app.goo.gl/MyHmeeURacx5LgTc6"
      },
      {
        no: 8,
        name: "Kumpulan Medic, Ampang Point (CC146)",
        address: "No 71-M, Jalan Mamanda 1, Ampang Point, 68000 Ampang",
        operatingHours: "Mon–Fri 8.30am–1.00pm, 2.00pm–9.00pm<br>Sat 8.30am–1.00pm, 2.00pm–4.00pm<br>Sun & PH 8.30am–12.00pm",
        emgsHours: "Mon–Fri 9.30am–1.00pm, 2.00pm–5.00pm<br>Sat 8.30am–1.00pm",
        doctor: "Dr. Azman @ Azhi b. Shamsuddin",
        contact: "03-4252 8219 / 8216<br>kmap@qualitas.com.my",
        map: "https://maps.app.goo.gl/KmCKEAhSuqHUUrHD7"
      },
      {
        no: 9,
        name: "Kumpulan Medic, Bangunan KWSP (CC148)",
        address: "Lot MZ 0.5, Mezzanine Floor, Bangunan KWSP, 50350 KL",
        operatingHours: "Mon–Fri 8.30am–5.00pm<br>Sat 8.30am–1.00pm, 2.00pm–4.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 8.30am–4.30pm<br>Sat 8.30am–12.30pm",
        doctor: "Dr. Renuka Yogalingam",
        contact: "03-2692 1952<br>kmkwsp@qualitas.com.my",
        map: "https://maps.app.goo.gl/Fu47ut5Xg4MtLGjH8"
      },
      {
        no: 10,
        name: "Klinik Catterall, Khoo & Raja Malek, Menara CIMB (CC203)",
        address: "Suite 3A, Level 3A, Menara CIMB, KL Sentral, 50470 KL",
        operatingHours: "Mon–Fri 8.30am–4.30pm<br>Sat 8.30am–12.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 8.30am–4.30pm<br>Sat 8.30am–12.00pm",
        doctor: "Dr. Low Ching Mun",
        contact: "03-2276 6622<br>ckmc@qualitas.com.my",
        map: "https://maps.app.goo.gl/dtJ7X4xBbx3FfL2s9"
      },
      {
        no: 11,
        name: "Reddy Clinic (CC163)",
        address: "121 Jalan Ipoh, 51200 KL",
        operatingHours: "24 Hours",
        emgsHours: "Mon–Fri 8.30am–4.30pm<br>Sat–Sun & PH Closed",
        doctor: "Dr. Kugan A/L Ramachandran",
        contact: "03-4041 2611 / 2721<br>rcji@qualitas.com.my",
        map: "https://maps.app.goo.gl/HFJNxmiLfSDRvTMm6"
      },
      {
        no: 12,
        name: "Klinik Sharani",
        address: "20 Jalan Bangsar Utama 1, 59000 KL",
        operatingHours: "Daily 8.00am–11.00pm",
        emgsHours: "Daily 8.00am–11.00pm",
        doctor: "Dr. Nikita Nair",
        contact: "03-2287 3103<br>kliniksharani@yahoo.com",
        map: "https://maps.app.goo.gl/DPWU16EPByrBwc1P6"
      },
      {
        no: 13,
        name: "Poliklinik Kumpulan City, Sri Petaling (CC215)",
        address: "No 26, GF, Jalan Radin Anum, 57000 Sri Petaling",
        operatingHours: "24 Hours",
        emgsHours: "Mon–Fri 7.00am–5.00pm",
        doctor: "Dr. Kew Chee Sum",
        contact: "03-9054 9662<br>pkcsripetaling@yahoo.com.my",
        map: "https://maps.app.goo.gl/iHQTK7wAxhsQQEzy8"
      },
      {
        no: 14,
        name: "Klinik Medic City (CC182)",
        address: "92 GF, Jalan Tun Sambanthan, 50470 Brickfields",
        operatingHours: "Mon–Fri 8.30am–9.00pm<br>Sat–Sun & PH 9.00am–1.00pm",
        emgsHours: "Mon–Fri 8.30am–4.00pm<br>Sat & Sun not available",
        doctor: "Dr. R. Narkunam",
        contact: "03-2274 2730<br>mediccity@gmail.com",
        map: "https://maps.app.goo.gl/VjRQsWpodGAMwBQt6"
      },
      {
        no: 15,
        name: "Poliklinik Anand dan Surgeri",
        address: "No. 47 Jalan Perdana 6/4, Pandan Perdana, 55300 KL",
        operatingHours: "Mon–Fri 9.00am–1.00pm, 2.00pm–4.00pm, 6.00pm–9.00pm<br>Sat–Sun & PH 9.00am–1.00pm",
        emgsHours: "Same as operating hours",
        doctor: "Dr. Anandan Subramaniam",
        contact: "03-9287 0507<br>sj_connie70@yahoo.com",
        map: "https://maps.app.goo.gl/oWQdnCY8xJmjoAhL7"
      },
      {
        no: 16,
        name: "Klinik Tar (CC213)",
        address: "329 Jalan Tuanku Abdul Rahman, 50100 KL",
        operatingHours: "Daily 9.00am–9.00pm",
        emgsHours: "Mon–Fri 9.00am–9.00pm",
        doctor: "Dr. Ganeshwaran A/L K. Muthusamy",
        contact: "03-2698 8122<br>ktar329@yahoo.com",
        map: "https://maps.app.goo.gl/NwThYMFV4gPkjgaQ6"
      },
      {
        no: 17,
        name: "Klinik Maha & Rao (CC225)",
        address: "No.19 Jalan Damai Perdana 1/9C, Bandar Damai Perdana, Cheras, 56000 KL",
        operatingHours: "Mon–Sat 9.00am–11.30pm<br>Sun & PH 9.00am–3.00pm, 6.00pm–11.30pm",
        emgsHours: "Mon–Sat 9.00am–6.00pm",
        doctor: "Dr. Balachendren A/L Kailasan",
        contact: "011-1664 0368<br>klinikmaharao16@gmail.com",
        map: "https://maps.app.goo.gl/GFw8QzLvct6NMWBF6"
      },
      {
        no: 18,
        name: "Koh Dispensary Sdn Bhd (CC229)",
        address: "Suite 21.02A, Level 21, Menara Citibank, 165 Jalan Ampang, 50450 KL",
        operatingHours: "Mon–Fri 9.00am–9.00pm, 2.00pm–5.00pm<br>Sat 9.00am–1.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 9.00am–1.00pm, 2.00pm–5.00pm<br>Sat 9.00am–1.00pm",
        doctor: "Dr. Ezayatun Binti Esa",
        contact: "03-2162 6128 / 7932 5022<br>kohdisp@yahoo.com",
        map: "https://maps.app.goo.gl/iNnCa4kguCVyxusj8"
      },
      {
        no: 19,
        name: "Klinik Catterall, Khoo & Raja Malek (Wisma FGV) (CC170)",
        address: "Suite G.1B, GF, Wisma FGV, Jalan Raja Laut, 50350 KL",
        operatingHours: "Mon–Fri 8.00am–4.30pm<br>Sat 8.00am–12.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 8.00am–12.30pm, 2.00pm–4.30pm",
        doctor: "Dr. Yustina Burhan",
        contact: "03-2693 7670 / 7669<br>ckws@qualitas.com.my",
        map: "https://maps.app.goo.gl/6t3xsJAAS8j7jY9Y6"
      },
      {
        no: 20,
        name: "Harish K Clinic",
        address: "Lot G116, GF, Bangsar Shopping Centre, 285 Jalan Maarof, 59000 KL",
        operatingHours: "Mon–Fri 9.00am–7.00pm<br>Sat 9.00am–1.00pm<br>Sun & PH Closed",
        emgsHours: "Mon–Fri 9.00am–5.00pm<br>Sat 9.00am–1.00pm",
        doctor: "Dr. Harish Kumar",
        contact: "03-2011 4336<br>cbsc@qualitas.com.my",
        map: "https://maps.app.goo.gl/ydyND7eeFoKPVz299"
      }
    ];

    // 显示EMGS诊所表格
    function showEmgsTable() {
      const container = document.getElementById('emgsTableContainer');
      const tbody = document.getElementById('emgsTableBody');
      
      // 清空表格内容
      tbody.innerHTML = '';
      
      // 生成表格行
      emgsClinics.forEach(clinic => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${clinic.no}</td>
          <td>${clinic.name}</td>
          <td>${clinic.address}</td>
          <td>${clinic.operatingHours}</td>
          <td>${clinic.emgsHours}</td>
          <td>${clinic.doctor}</td>
          <td>${clinic.contact}</td>
          <td><a href="${clinic.map}" target="_blank">查看地图</a></td>
        `;
        tbody.appendChild(row);
      });
      
      // 显示表格
      container.style.display = 'block';
    }

    // 隐藏EMGS诊所表格
    function hideEmgsTable() {
      const container = document.getElementById('emgsTableContainer');
      container.style.display = 'none';
    }

    // 地区选择逻辑
    document.getElementById('regionSelect').addEventListener('change', function() {
      const selectedValue = this.value;
      const selectedText = this.options[this.selectedIndex].text;
      
      if (selectedValue === 'kuala-lumpur') {
        showEmgsTable();
      } else {
        hideEmgsTable();
        if (selectedValue) {
          alert("您选择了: " + selectedText);
        }
      }
    });
    // 和你之前页面一致的最小依赖
  const API_BASE = 'http://127.0.0.1:3001';

  // 把相对路径头像补成绝对路径
  function toAbs(u){
    if(!u) return '';
    if(/^https?:\/\//i.test(u)) return u;
    return u.startsWith('/') ? API_BASE + u : API_BASE + '/' + u;
  }

  // 恢复：优先从服务器获取最新用户信息，回退到 localStorage
  async function hydrateUser(){
    try{
      const avatarEl = document.querySelector('.avatar');
      const nameEl   = document.querySelector('.username');

      // 占位头像
      const FALLBACK = 'https://raw.githubusercontent.com/WH-An/hwlx-app/2df4e97b395bebb7977074fbb31741f3c35da9a0/assets-task_01k3v2vy06fra8er06x602xnpe-1756476933_img_1.webp';

      // 优先从服务器获取最新用户信息
      try {
        const response = await fetch(API_BASE + '/api/users/me', { 
          credentials: 'include' 
        });
        
        if (response.ok) {
          const user = await response.json();
          const name = user.nickname || user.username || user.displayName || user.name || user.email || '我的账号';
          let avatar = user.avatarPath || user.avatarUrl || user.avatar || '';

          if(avatar && !/^https?:\/\//i.test(avatar)) {
            avatar = toAbs(avatar);
          }

          nameEl.textContent = name;
          nameEl.title = name;
          avatarEl.onerror = ()=>{ avatarEl.src = FALLBACK; };
          avatarEl.src = avatar || FALLBACK;
          avatarEl.alt = name;
          
          // 更新本地存储
          localStorage.setItem('currentUser', JSON.stringify(user));
          return;
        }
      } catch (e) {
        console.warn('从服务器获取用户信息失败，使用本地存储:', e);
      }

      // 如果服务器获取失败，回退到本地存储
      const raw = localStorage.getItem('currentUser')
                || localStorage.getItem('user')
                || localStorage.getItem('USER')
                || localStorage.getItem('auth_user');

      if(!raw){
        nameEl.textContent = '我的账号';
        avatarEl.src = FALLBACK;
        return;
      }

      const u = JSON.parse(raw) || {};
      const name = u.nickname || u.username || u.displayName || u.name || u.email || '我的账号';
      let avatar = u.avatarPath || u.avatarUrl || u.avatar || '';

      if(avatar && !/^https?:\/\//i.test(avatar)) {
        avatar = toAbs(avatar);
      }

      nameEl.textContent = name;
      nameEl.title = name;
      avatarEl.onerror = ()=>{ avatarEl.src = FALLBACK; };
      avatarEl.src = avatar || FALLBACK;
      avatarEl.alt = name;
    }catch(e){
      console.error('用户信息渲染失败:', e);
      // 出错也给个兜底
      const avatarEl = document.querySelector('.avatar');
      const nameEl   = document.querySelector('.username');
      nameEl.textContent = '我的账号';
      avatarEl.src = FALLBACK;
    }
  }

  // 页面就绪后执行
  window.addEventListener('DOMContentLoaded', () => {
    hydrateUser();
  });
  </script>
</body>
</html>
