# 邮件服务配置说明

## 概述
本应用使用Gmail SMTP服务发送邮箱验证码。用户注册时需要输入邮箱验证码来验证邮箱的真实性。

## 配置步骤

### 1. 创建Gmail应用专用密码

1. 登录您的Gmail账户
2. 进入 [Google账户设置](https://myaccount.google.com/)
3. 点击"安全性"
4. 在"登录Google"部分，点击"2步验证"
5. 如果未启用，请先启用2步验证
6. 在"应用专用密码"部分，点击"应用专用密码"
7. 选择"其他"，输入应用名称（如"）
8. 复制生成的16位密码

### 2. 配置环境变量

在项目根目录创建 `.env` 文件，添加以下配置：

```bash
# 邮件配置 (Gmail)
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-16-digit-app-password
```

**重要提示：**
- `EMAIL_USER` 必须是您的Gmail邮箱地址
- `EMAIL_PASS` 必须是应用专用密码，不是您的Gmail登录密码
- 请确保 `.env` 文件已添加到 `.gitignore` 中，避免泄露敏感信息

### 3. 重启服务器

配置完成后，重启Node.js服务器：

```bash
npm start
```

### 4. 验证配置

服务器启动后，您应该看到以下日志：

```
✅ MongoDB连接成功
✅ 邮件服务配置成功
🚀 Cloudinary服务器运行在端口 10000
📱 本地访问: http://localhost:10000
☁️ 使用Cloudinary存储文件
📧 邮件服务: 已启用
```

如果看到 "⚠️ 邮件服务配置失败"，请检查：
- 环境变量是否正确设置
- Gmail应用专用密码是否正确
- 网络连接是否正常

## 功能特性

- **验证码有效期**: 5分钟
- **重发限制**: 同一邮箱5分钟内只能发送一次验证码
- **尝试次数限制**: 每个验证码最多尝试5次
- **自动过期**: 验证码使用后自动标记为已使用
- **安全存储**: 验证码存储在数据库中，支持自动清理

## 邮件模板

验证码邮件包含：
- 专业的HTML格式
- 清晰的验证码显示
- 安全提示和注意事项
- 有效期说明

## 故障排除

### 常见问题

1. **"邮件服务配置失败"**
   - 检查环境变量设置
   - 确认Gmail应用专用密码正确
   - 检查网络连接

2. **"发送验证码失败"**
   - 检查邮箱格式是否正确
   - 确认服务器正在运行
   - 查看服务器控制台错误日志

3. **验证码无法接收**
   - 检查垃圾邮件文件夹
   - 确认邮箱地址拼写正确
   - 等待几分钟后重试

### 调试方法

1. 查看服务器控制台日志
2. 检查浏览器开发者工具的网络请求
3. 验证API端点是否可访问

## 安全注意事项

- 不要将 `.env` 文件提交到版本控制系统
- 定期更换应用专用密码
- 监控邮件发送日志，发现异常及时处理
- 考虑添加发送频率限制防止滥用

## 技术支持

如果遇到问题，请：
1. 检查本文档的故障排除部分
2. 查看服务器控制台日志
3. 确认所有配置步骤已完成
4. 联系技术支持团队
